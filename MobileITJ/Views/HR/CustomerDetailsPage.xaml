<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:MobileITJ.ViewModels"
             x:Class="MobileITJ.Views.HR.CustomerDetailsPage"
             Title="Customer Profile"
             BackgroundColor="#F5F5F5">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Frame CornerRadius="15" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="5">
                    <Label Text="{Binding Customer.FirstName, StringFormat='{0} (Customer)'}" 
                           FontSize="22" FontAttributes="Bold" TextColor="Black"/>
                    <Label Text="{Binding Customer.Email}" FontSize="14" TextColor="Gray"/>
                    <Label Text="{Binding Customer.Id, StringFormat='User ID: {0}'}" FontSize="12" TextColor="LightGray"/>
                </VerticalStackLayout>
            </Frame>

            <Label Text="Job History &amp; Payments" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0"/>

            <CollectionView ItemsSource="{Binding JobHistory}">
                <CollectionView.EmptyView>
                    <Label Text="No jobs posted by this customer." TextColor="Gray" HorizontalOptions="Center"/>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="15" Margin="0,0,0,15" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                            <VerticalStackLayout Spacing="10">

                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="{Binding Job.JobDescription}" FontAttributes="Bold" FontSize="16"/>
                                        <Label Text="{Binding Job.DatePosted, StringFormat='Posted: {0:MM/dd/yy}'}" FontSize="10" TextColor="Gray"/>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding Job.Status}" TextColor="Blue" FontAttributes="Bold" VerticalOptions="Center"/>
                                </Grid>

                                <BoxView HeightRequest="1" Color="#EEE" />

                                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Workers}" Spacing="8">
                                    <BindableLayout.EmptyView>
                                        <Label Text="No workers applied yet." FontSize="12" FontAttributes="Italic" TextColor="Gray"/>
                                    </BindableLayout.EmptyView>

                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="2*, 1*, 1*">
                                                <VerticalStackLayout Grid.Column="0">
                                                    <Label Text="{Binding WorkerName}" FontSize="14" FontAttributes="Bold"/>
                                                    <Label Text="{Binding WorkStatus}" FontSize="10" TextColor="Gray"/>
                                                </VerticalStackLayout>

                                                <Frame Grid.Column="2" Padding="5,2" CornerRadius="5" HorizontalOptions="End" VerticalOptions="Center">
                                                    <Frame.Triggers>
                                                        <DataTrigger TargetType="Frame" Binding="{Binding IsPaid}" Value="True">
                                                            <Setter Property="BackgroundColor" Value="#E8F5E9"/>
                                                            <Setter Property="BorderColor" Value="Green"/>
                                                        </DataTrigger>
                                                        <DataTrigger TargetType="Frame" Binding="{Binding IsPaid}" Value="False">
                                                            <Setter Property="BackgroundColor" Value="#FFEBEE"/>
                                                            <Setter Property="BorderColor" Value="Red"/>
                                                        </DataTrigger>
                                                    </Frame.Triggers>
                                                    <Label Text="{Binding PaymentStatus}" FontSize="10" FontAttributes="Bold">
                                                        <Label.Triggers>
                                                            <DataTrigger TargetType="Label" Binding="{Binding IsPaid}" Value="True">
                                                                <Setter Property="TextColor" Value="Green"/>
                                                            </DataTrigger>
                                                            <DataTrigger TargetType="Label" Binding="{Binding IsPaid}" Value="False">
                                                                <Setter Property="TextColor" Value="Red"/>
                                                            </DataTrigger>
                                                        </Label.Triggers>
                                                    </Label>
                                                </Frame>
                                            </Grid>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>