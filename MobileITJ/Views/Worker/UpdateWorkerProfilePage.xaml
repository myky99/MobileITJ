<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MobileITJ.Models"
             xmlns:viewmodel="clr-namespace:MobileITJ.ViewModels"
             x:DataType="viewmodel:UpdateProfileViewModel"
             x:Class="MobileITJ.Views.Worker.UpdateWorkerProfilePage"
             Title="My Profile"
             BackgroundColor="{StaticResource BackgroundColor}">

    <RefreshView Command="{Binding LoadProfileCommand}" 
                 IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="15" IsVisible="{Binding Profile, Converter={StaticResource IsNotNullConverter}}">

                <Label Text="{Binding Profile.FullName}"
                       FontSize="28"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="{StaticResource TextDark}" />

                <Label Text="{Binding Profile.WorkerId}"
                       FontSize="16"
                       TextColor="Gray"
                       HorizontalOptions="Center" />

                <Frame Padding="15" Margin="0,15" CornerRadius="10">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Email" FontAttributes="Bold" />
                        <Label Text="{Binding Profile.Email}" />

                        <Label Text="My Rate" FontAttributes="Bold" Margin="0,10,0,0" />
                        <Label Text="{Binding Profile.RatePerHour, StringFormat='{0:C}/hr'}" TextColor="{StaticResource PrimaryColor}" />

                        <Label Text="Status" FontAttributes="Bold" Margin="0,10,0,0" />
                        <Label Text="{Binding Profile.IsActive, Converter={StaticResource BoolToIsActiveConverter}}" />
                    </VerticalStackLayout>
                </Frame>

                <Grid ColumnDefinitions="*, Auto" Margin="0,5">
                    <Label Grid.Column="0" Text="My Skills" FontSize="20" FontAttributes="Bold" VerticalOptions="Center"/>
                    <Button Grid.Column="1" Text="+ Add Skill" 
                            Command="{Binding ToggleAddSkillCommand}"
                            FontSize="12" HeightRequest="30" Padding="10,0"
                            BackgroundColor="Transparent" TextColor="{StaticResource PrimaryColor}"/>
                </Grid>

                <Frame IsVisible="{Binding IsAddingSkill}" Padding="10" BackgroundColor="#F5F5F5" BorderColor="LightGray" CornerRadius="8">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Select New Skill:" FontSize="12" FontAttributes="Bold" TextColor="Gray"/>

                        <Frame Padding="0" BorderColor="LightGray" CornerRadius="5" HasShadow="False">
                            <Picker Title="Select Skill Category"
                                    ItemsSource="{Binding AvailableSkills}"
                                    SelectedItem="{Binding SelectedSkill}"
                                    TextColor="Black" TitleColor="Gray"/>
                        </Frame>

                        <Entry Placeholder="Type custom skill..." 
                               Text="{Binding CustomSkillEntry}"
                               IsVisible="{Binding IsCustomSkillVisible}"
                               BackgroundColor="White"/>

                        <Button Text="Save Skill" 
                                Command="{Binding SaveSkillCommand}"
                                BackgroundColor="{StaticResource PrimaryColor}" 
                                TextColor="White"
                                HeightRequest="40"
                                CornerRadius="5"/>
                    </VerticalStackLayout>
                </Frame>
                <CollectionView ItemsSource="{Binding Profile.Skills}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="x:String">
                            <Frame Padding="10" Margin="0,2" BorderColor="LightGray" HasShadow="False">
                                <Label Text="{Binding .}" FontSize="16"/>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Button Text="View My Wallet"
                        Command="{Binding NavigateToWalletCommand}"
                        Style="{StaticResource TopTabButton}"
                        BackgroundColor="{StaticResource PrimaryColor}"
                        TextColor="White"
                        Margin="0,20,0,0"
                        HorizontalOptions="Fill" />

                <Button Text="Change My Password"
                        Command="{Binding NavigateToChangePasswordCommand}"
                        Style="{StaticResource TopTabButton}"
                        BackgroundColor="White"
                        TextColor="{StaticResource TextDark}"
                        BorderColor="{StaticResource TextDark}"
                        Margin="0,10,0,0"
                        HorizontalOptions="Fill" />


            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>