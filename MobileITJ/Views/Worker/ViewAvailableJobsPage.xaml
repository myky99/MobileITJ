<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MobileITJ.Models"
             xmlns:viewmodel="clr-namespace:MobileITJ.ViewModels"
             x:DataType="viewmodel:ViewAvailableJobsViewModel"
             x:Class="MobileITJ.Views.Worker.ViewAvailableJobsPage"
             Title="Available Jobs"
             BackgroundColor="{StaticResource BackgroundColor}"
             x:Name="ThisPage">

    <Grid RowDefinitions="Auto, *">
        <VerticalStackLayout Grid.Row="0" Padding="15,10" Spacing="10" BackgroundColor="White">
            <SearchBar Placeholder="Search Title or Location..." Text="{Binding SearchText}" BackgroundColor="#F0F0F0"/>
            <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                <Frame Grid.Column="0" Padding="0" BorderColor="LightGray" CornerRadius="5" HasShadow="False" HeightRequest="40">
                    <Picker Title="Filter by Skill" ItemsSource="{Binding SkillCategories}" SelectedItem="{Binding SelectedCategory}" TextColor="Black" TitleColor="Gray" HorizontalTextAlignment="Center"/>
                </Frame>
                <Button Grid.Column="1" Text="Reset" Command="{Binding ClearFiltersCommand}" FontSize="12" HeightRequest="40" BackgroundColor="Gray" TextColor="White"/>
            </Grid>
            <Entry Placeholder="Type specific skill to find..." Text="{Binding CustomSkillFilter}" IsVisible="{Binding IsCustomSkillFilterVisible}" BackgroundColor="#F0F0F0" Margin="0,0,0,5"/>
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" Command="{Binding LoadJobsCommand}" IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding AvailableJobs}" EmptyView="No jobs match your search.">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Job">
                        <Frame Padding="15" Margin="10,5" CornerRadius="10" BorderColor="#E0E0E0" HasShadow="True">
                            <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto" ColumnDefinitions="*">
                                <Label Grid.Row="0" Text="{Binding Title}" FontAttributes="Bold" FontSize="20" TextColor="{StaticResource PrimaryColor}"/>
                                <Label Grid.Row="1" Text="{Binding JobDescription}" FontSize="16" TextColor="Black" Margin="0,2,0,0"/>
                                <Label Grid.Row="2" Text="{Binding Location}" FontSize="14" Margin="0,5,0,0" TextColor="Gray"/>
                                <Label Grid.Row="3" Text="{Binding SkillsNeeded, Converter={StaticResource SkillsListToStringConverter}}" FontSize="14" FontAttributes="Italic" TextColor="DarkGray" Margin="0,5,0,0"/>

                                <Label Grid.Row="4" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}" Margin="0,10,0,0">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Rate: "/>
                                            <Span Text="{Binding RatePerHour, StringFormat='Php {0:N2}/hr'}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Button Grid.Row="5" Text="Apply for this Job" Style="{StaticResource TopTabButton}" BackgroundColor="{StaticResource SecondaryColor}" TextColor="White" Margin="0,15,0,0" HorizontalOptions="Start" Command="{Binding BindingContext.ApplyJobCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding .}"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>