<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MobileITJ.Models"
             xmlns:viewmodel="clr-namespace:MobileITJ.ViewModels"
             x:DataType="viewmodel:ViewMyJobReportsViewModel"
             x:Class="MobileITJ.Views.Customer.ViewMyJobReportsPage"
             Title="View My Reports"
             BackgroundColor="{StaticResource BackgroundColor}"
             x:Name="ThisPage">

    <RefreshView Command="{Binding LoadDataCommand}" 
                 IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="10" Spacing="20">

                <Label Text="File a Report" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center"/>
                <Label Text="Select an active worker to file a report against." HorizontalOptions="Center" FontSize="14" TextColor="Gray"/>

                <CollectionView ItemsSource="{Binding ActiveWorkers}"
                                EmptyView="No active workers found."
                                HeightRequest="250">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:WorkerDetail">
                            <Frame Padding="10" Margin="5" CornerRadius="10" BorderColor="#E0E0E0">
                                <Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
                                    <VerticalStackLayout Spacing="5">
                                        <Label Text="{Binding FullName}" FontAttributes="Bold" FontSize="16"/>
                                        <Label Text="{Binding SkillsDisplay}" FontSize="12" TextColor="Gray"/>
                                    </VerticalStackLayout>
                                    <Button Grid.Column="1" 
                                            Text="File Report"
                                            Style="{StaticResource TopTabButton}"
                                            BackgroundColor="{StaticResource DangerColor}"
                                            TextColor="White"
                                            FontSize="10" Padding="8,4"
                                            Command="{Binding BindingContext.FileReportCommand, Source={x:Reference ThisPage}}"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <BoxView HeightRequest="1" Color="Gray" Margin="0,10" />
                <Label Text="My Filed Reports" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center"/>

                <CollectionView ItemsSource="{Binding MyFiledWorkerReports}"
                                EmptyView="You have not filed any reports.">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:WorkerReport">
                            <Frame Padding="15" Margin="5" CornerRadius="10" BorderColor="#E0E0E0">
                                <VerticalStackLayout Spacing="5">
                                    <Label Text="{Binding WorkerName}" FontAttributes="Bold" FontSize="16"/>
                                    <Label Text="{Binding ReportMessage}" FontAttributes="Italic" Margin="0,5,0,0"/>
                                    <Label Text="{Binding DateFiled, StringFormat='Filed on: {0:MMM dd, yyyy}'}" FontSize="12" TextColor="Gray" Margin="0,5,0,0"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>